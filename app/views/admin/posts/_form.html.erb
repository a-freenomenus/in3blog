<script type="text/javascript">
  function playerCode(mp3_url) {
    var code = '<object type="application/x-shockwave-flash" data="/player_mp3_maxi.swf" width="200" height="20">'
        + '<param name="movie" value="player_mp3_maxi.swf" />'
        + '<param name="FlashVars" value="mp3=' + mp3_url + '&showvolume=1&showloading=always" />'
        + '</object>';
    return code;
  }
  function insertHTML(html) {
      tinyMCE.execInstanceCommand('post_body', 'mceInsertContent', false, html, true);
  }

</script>
<% content_for :head do %>
  <%= include_tiny_mce_if_needed %>
<% end %>

<% form_for @post, :url => @post.new_record? ? admin_posts_path : admin_post_path(@post) do |f| %>
  <%= f.error_messages %>
  <p>
    <%= f.label :title %><br />
    <%= f.text_field :title %>
  </p>
  <p>
    <%= f.label :body %><br />
    <%= f.text_area :body, :class => "mceEditor" %>
  </p>
  <p><%= f.submit "Submit" %></p>
<% end %>

<ul id="audios">
  <% for audio in Audio.all %>
    <li>
      <%= audio.mp3_file_name %>
      <%= link_to_function 'Insert', "insertHTML(playerCode('#{audio.mp3.url(:original, false)}'))" %>
    </li>
  <% end %>
</ul>
